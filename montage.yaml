---
name: "montage_workflow"
dataIns:
- name: "bucket"
  type: "string"
  source: "bucket"
- name: "header"
  type: "string"
  source: "header"
- name: "color_folders"
  type: "collection"
  source: "color_folders"
- name: "aws_access_key_id"
  type: "string"
  source: "aws_access_key_id"
- name: "aws_secret_access_key"
  type: "string"
  source: "aws_secret_access_key"
- name: "aws_session_token"
  type: "string"
  source: "aws_session_token"
- name: "gcp_project_id"
  type: "string"
  source: "gcp_project_id"
- name: "gcp_client_email"
  type: "string"
  source: "gcp_client_email"
- name: "gcp_private_key"
  type: "string"
  source: "gcp_private_key"
workflowBody:
- function:
    name: "prepareColor"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      source: "montage_workflow/bucket"
    - name: "header"
      type: "string"
      source: "montage_workflow/header"
    - name: "color_folders"
      type: "collection"
      source: "montage_workflow/color_folders"
    - name: "aws_access_key_id"
      type: "string"
      source: "montage_workflow/aws_access_key_id"
    - name: "aws_secret_access_key"
      type: "string"
      source: "montage_workflow/aws_secret_access_key"
    - name: "aws_session_token"
      type: "string"
      source: "montage_workflow/aws_session_token"
    - name: "gcp_project_id"
      type: "string"
      source: "montage_workflow/gcp_project_id"
    - name: "gcp_client_email"
      type: "string"
      source: "montage_workflow/gcp_client_email"
    - name: "gcp_private_key"
      type: "string"
      source: "montage_workflow/gcp_private_key"
    dataOuts:
    - name: "number"
      type: "number"
    - name: "bucket"
      type: "string"
    - name: "header"
      type: "string"
    - name: "color_folders"
      type: "string"
    - name: "credentials"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:prepare-Color_2048_sched"
    - name: "service"
      value: "FILE_UP:us-east-1:1:0.005"
    - name: "service"
      value: "UT_REMOVE:eu-west-2:1:0.005"
- function:
    name: "preparemProjectPP"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "header"
      type: "string"
      source: "prepareColor/header"
    - name: "color_folder"
      type: "string"
      source: "prepareColor/color_folders"
    - name: "credentials"
      type: "collection"
      source: "prepareColor/credentials"
    dataOuts:
    - name: "filenames"
      type: "collection"
    - name: "number"
      type: "number"
      properties:
      - name: "simValue"
        value: 30
    - name: "bucket"
      type: "string"
    - name: "header"
      type: "string"
    - name: "color_folder"
      type: "string"
    - name: "credentials"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:prepare-m_ProjectPP_2048_sched"
- parallelFor:
    name: "mProjectPPs"
    dataIns:
    - name: "filename"
      type: "string"
      source: "preparemProjectPP/filenames"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "bucket"
      type: "string"
      source: "preparemProjectPP/bucket"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "header"
      type: "string"
      source: "preparemProjectPP/header"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "color_folder"
      type: "string"
      source: "preparemProjectPP/color_folder"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "credentials"
      type: "collection"
      source: "preparemProjectPP/credentials"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    loopCounter:
      type: "number"
      from: "0"
      to: "preparemProjectPP/number"
      step: "1"
    loopBody:
    - function:
        name: "mProjectPP"
        type: "Collection"
        deployment: "AWS_eu-central-1_2048"
        dataIns:
        - name: "filename"
          type: "string"
          source: "mProjectPPs/filename"
        - name: "bucket"
          type: "string"
          value: "arn:aws:s3:::montage-nv"
        - name: "output_bucket"
          type: "string"
          value: "arn:aws:s3:::montage-nv"
        - name: "header"
          type: "string"
          source: "mProjectPPs/header"
        - name: "color_folder"
          type: "string"
          source: "mProjectPPs/color_folder"
        - name: "credentials"
          type: "collection"
          source: "mProjectPPs/credentials"
        dataOuts:
        - name: "color_folder"
          type: "string"
        - name: "credentials"
          type: "collection"
        properties:
        - name: "resource"
          value: "arn:aws:lambda:eu-west-2:000000000000:function:m_ProjectPP_2048_sched"
        - name: "service"
          value: "FILE_DL:us-east-1:2:1.37"
        - name: "service"
          value: "FILE_UP:us-east-1:2:7.9"
        - name: "service"
          value: "DT_REMOVE:eu-west-2:2:1.37"
        - name: "service"
          value: "UT_REMOVE:eu-west-2:2:7.9"
    dataOuts:
    - name: "bucket"
      type: "string"
      source: "mProjectPPs/bucket"
    - name: "header"
      type: "string"
      source: "mProjectPPs/header"
    - name: "color_folder"
      type: "string"
      source: "mProjectPP/color_folder"
    - name: "credentials"
      type: "string"
      source: "mProjectPP/credentials"
    constraints:
    - name: "concurrency"
      value: "950"
- function:
    name: "preparemDiffFit"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "output_bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "header"
      type: "string"
      source: "mProjectPPs/header"
    - name: "color_folder"
      type: "string"
      source: "mProjectPPs/color_folder"
    - name: "credentials"
      type: "collection"
      source: "mProjectPPs/credentials"
    dataOuts:
    - name: "diff_rows"
      type: "collection"
    - name: "number"
      type: "number"
      properties:
      - name: "simValue"
        value: 141
    - name: "bucket"
      type: "string"
    - name: "header"
      type: "string"
    - name: "color_folder"
      type: "string"
    - name: "credentials"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:prepare-m_DiffFit_2048_sched"
    - name: "service"
      value: "DT_REMOVE:eu-west-2:31:41.81"
    - name: "service"
      value: "UT_REMOVE:eu-west-2:2:0.02"
    - name: "service"
      value: "FILE_DL:us-east-1:31:41.81"
    - name: "service"
      value: "FILE_UP:us-east-1:2:0.02"
- parallelFor:
    name: "mDiffFits"
    dataIns:
    - name: "diff"
      type: "string"
      source: "preparemDiffFit/diff_rows"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "bucket"
      type: "string"
      source: "preparemDiffFit/bucket"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "header"
      type: "string"
      source: "preparemDiffFit/header"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "color_folder"
      type: "string"
      source: "preparemDiffFit/color_folder"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "credentials"
      type: "collection"
      source: "preparemDiffFit/credentials"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    loopCounter:
      type: "number"
      from: "0"
      to: "preparemDiffFit/number"
      step: "1"
    loopBody:
    - function:
        name: "mDiffFit"
        type: "Collection"
        deployment: "AWS_eu-central-1_2048"
        dataIns:
        - name: "diff"
          type: "string"
          source: "mDiffFits/diff"
        - name: "bucket"
          type: "string"
          value: "arn:aws:s3:::montage-nv"
        - name: "output_bucket"
          type: "string"
          value: "arn:aws:s3:::montage-nv"
        - name: "header"
          type: "string"
          source: "mDiffFits/header"
        - name: "color_folder"
          type: "string"
          source: "mDiffFits/color_folder"
        - name: "credentials"
          type: "collection"
          source: "mDiffFits/credentials"
        dataOuts:
        - name: "color_folder"
          type: "string"
        - name: "credentials"
          type: "collection"
        - name: "filename"
          type: "string"
        - name: "filecontent"
          type: "string"
        properties:
        - name: "resource"
          value: "arn:aws:lambda:eu-west-2:000000000000:function:m_DiffFit_2048_2"
        - name: "service"
          value: "FILE_DL:us-east-1:5:15.8"
        - name: "service"
          value: "DT_REMOVE:eu-west-2:5:15.8"
    dataOuts:
    - name: "bucket"
      type: "string"
      source: "mDiffFits/bucket"
    - name: "header"
      type: "string"
      source: "mDiffFits/header"
    - name: "color_folder"
      type: "string"
      source: "mDiffFit/color_folder"
    - name: "credentials"
      type: "string"
      source: "mDiffFit/credentials"
    - name: "filenames"
      type: "collection"
      source: "mDiffFit/filename"
    - name: "filecontents"
      type: "collection"
      source: "mDiffFit/filecontent"
    constraints:
    - name: "concurrency"
      value: "950"
- function:
    name: "mConcatFit"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "output_bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "header"
      type: "string"
      source: "mDiffFits/header"
    - name: "color_folder"
      type: "string"
      source: "mDiffFits/color_folder"
    - name: "credentials"
      type: "collection"
      source: "mDiffFits/credentials"
    - name: "filenames"
      type: "collection"
      source: "mDiffFits/filenames"
    - name: "filecontents"
      type: "collection"
      source: "mDiffFits/filecontents"
    dataOuts:
    - name: "bucket"
      type: "string"
    - name: "header"
      type: "string"
    - name: "color_folder"
      type: "string"
    - name: "credentials"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:m_ConcatFit_2048_2"
    - name: "service"
      value: "FILE_DL:us-east-1:2:0.02"
    - name: "service"
      value: "FILE_UP:us-east-1:2:0.03"
    - name: "service"
      value: "DT_REMOVE:eu-west-2:2:0.02"
    - name: "service"
      value: "UT_REMOVE:eu-west-2:2:0.03"
- function:
    name: "mBgModel"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "output_bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "header"
      type: "string"
      source: "mConcatFit/header"
    - name: "color_folder"
      type: "string"
      source: "mConcatFit/color_folder"
    - name: "credentials"
      type: "collection"
      source: "mConcatFit/credentials"
    dataOuts:
    - name: "bucket"
      type: "string"
    - name: "header"
      type: "string"
    - name: "color_folder"
      type: "string"
    - name: "credentials"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:m_BgModel_2048_sched"
    - name: "service"
      value: "FILE_DL:us-east-1:2:0.03"
    - name: "service"
      value: "FILE_UP:us-east-1:1:0.002"
    - name: "service"
      value: "DT_REMOVE:eu-west-2:2:0.03"
    - name: "service"
      value: "UT_REMOVE:eu-west-2:1:0.002"
- function:
    name: "preparemBackground"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "output_bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "header"
      type: "string"
      source: "mBgModel/header"
    - name: "color_folder"
      type: "string"
      source: "mBgModel/color_folder"
    - name: "credentials"
      type: "collection"
      source: "mBgModel/credentials"
    dataOuts:
    - name: "filenames"
      type: "collection"
    - name: "number"
      type: "number"
      properties:
      - name: "simValue"
        value: 30
    - name: "bucket"
      type: "string"
    - name: "header"
      type: "string"
    - name: "color_folder"
      type: "string"
    - name: "credentials"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:prepare-m_Background_2048_sched"
    - name: "service"
      value: "FILE_DL:us-east-1:1:0.005"
    - name: "service"
      value: "DT_REMOVE:eu-west-2:1:0.005"
- parallelFor:
    name: "mBackgrounds"
    dataIns:
    - name: "filename"
      type: "string"
      source: "preparemBackground/filenames"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "bucket"
      type: "string"
      source: "preparemBackground/bucket"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "header"
      type: "string"
      source: "preparemBackground/header"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "color_folder"
      type: "string"
      source: "preparemBackground/color_folder"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "credentials"
      type: "collection"
      source: "preparemBackground/credentials"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    loopCounter:
      type: "number"
      from: "0"
      to: "preparemBackground/number"
      step: "1"
    loopBody:
    - function:
        name: "mBackground"
        type: "Collection"
        deployment: "AWS_eu-central-1_2048"
        dataIns:
        - name: "filename"
          type: "string"
          source: "mBackgrounds/filename"
        - name: "bucket"
          type: "string"
          value: "arn:aws:s3:::montage-nv"
        - name: "output_bucket"
          type: "string"
          value: "arn:aws:s3:::montage-nv"
        - name: "color_folder"
          type: "string"
          source: "mBackgrounds/color_folder"
        - name: "credentials"
          type: "collection"
          source: "mBackgrounds/credentials"
        dataOuts:
        - name: "color_folder"
          type: "string"
        - name: "credentials"
          type: "collection"
        properties:
        - name: "resource"
          value: "arn:aws:lambda:eu-west-2:000000000000:function:m_Background_2048_sched"
        - name: "service"
          value: "FILE_DL:us-east-1:4:7.9"
        - name: "service"
          value: "FILE_UP:us-east-1:1:3.94"
        - name: "service"
          value: "DT_REMOVE:eu-west-2:4:7.9"
        - name: "service"
          value: "UT_REMOVE:eu-west-2:1:3.94"
    dataOuts:
    - name: "bucket"
      type: "string"
      source: "mBackgrounds/bucket"
    - name: "header"
      type: "string"
      source: "mBackgrounds/header"
    - name: "color_folder"
      type: "string"
      source: "mBackground/color_folder"
    - name: "credentials"
      type: "string"
      source: "mBackground/credentials"
    constraints:
    - name: "concurrency"
      value: "950"
- function:
    name: "mImgtbl"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "output_bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "header"
      type: "string"
      source: "mBackgrounds/header"
    - name: "color_folder"
      type: "string"
      source: "mBackgrounds/color_folder"
    - name: "credentials"
      type: "collection"
      source: "mBackgrounds/credentials"
    dataOuts:
    - name: "bucket"
      type: "string"
    - name: "header"
      type: "string"
    - name: "color_folder"
      type: "string"
    - name: "credentials"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:m_Imgtbl_2048_sched"
    - name: "service"
      value: "FILE_DL:us-east-1:30:118.51"
    - name: "service"
      value: "FILE_UP:us-east-1:1:1:0.02"
    - name: "service"
      value: "DT_REMOVE:eu-west-2:30:118.51"
    - name: "service"
      value: "UT_REMOVE:eu-west-2:1:0.02"
- function:
    name: "mAdd"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "output_bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "header"
      type: "string"
      source: "mImgtbl/header"
    - name: "color_folder"
      type: "string"
      source: "mImgtbl/color_folder"
    - name: "credentials"
      type: "collection"
      source: "mImgtbl/credentials"
    dataOuts:
    - name: "bucket"
      type: "string"
    - name: "color_folder"
      type: "string"
    - name: "credentials"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:m_Add_2048_sched"
    - name: "service"
      value: "DT_REMOVE:eu-west-2:32:118.53"
    - name: "service"
      value: "UT_REMOVE:eu-west-2:1:116.05"
    - name: "service"
      value: "FILE_DL:us-east-1:32:118.53"
    - name: "service"
      value: "FILE_UP:us-east-1:1:116.05"
- function:
    name: "mShrink"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      #source: "mAdd/bucket"
      value: "arn:aws:s3:::montage-nv"
    - name: "output_bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "color_folder"
      type: "string"
      source: "mAdd/color_folder"
    - name: "credentials"
      type: "collection"
      source: "mAdd/credentials"
    dataOuts:
    - name: "bucket"
      type: "string"
    - name: "color_folder"
      type: "string"
    - name: "credentials"
      type: "collection"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:m_Shrink_2048_sched"
    - name: "service"
      value: "FILE_DL:us-east-1:1:116.05"
    - name: "service"
      value: "FILE_UP:us-east-1:1:51.58"
    - name: "service"
      value: "DT_REMOVE:eu-west-2:1:116.05"
    - name: "service"
      value: "UT_REMOVE:eu-west-2:1:51.58"
- function:
    name: "mViewer"
    type: "Collection"
    deployment: "AWS_eu-central-1_2048"
    dataIns:
    - name: "bucket"
      type: "string"
      #source: "mShrink/bucket"
      value: "arn:aws:s3:::montage-nv"
    - name: "output_bucket"
      type: "string"
      value: "arn:aws:s3:::montage-nv"
    - name: "color_folder"
      type: "string"
      source: "mShrink/color_folder"
    - name: "credentials"
      type: "collection"
      source: "mShrink/credentials"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-west-2:000000000000:function:m_Viewer_2048_sched"
    - name: "service"
      value: "FILE_DL:us-east-1:2:51.58"
    - name: "service"
      value: "FILE_UP:us-east-1:1:2.32"
    - name: "service"
      value: "DT_REMOVE:eu-west-2:2:51.58"
    - name: "service"
      value: "UT_REMOVE:eu-west-2:1:2.32"
